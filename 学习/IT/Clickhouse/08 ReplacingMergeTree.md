# 08 ReplacingMergeTree

## ReplacingMergeTree

与MergeTree相比，排序键值可以进行去重，但是只会在合并期间进行，合并前并不能保证数据的不重复。

作用场景：删除重复数据节省空间，不保证数据的唯一。

去重时根据最后插入或者版本列最大（自定，UInt*, Date, Datetime类型的列）去保留数据。

注意：

1. 按照order by排序键进行去重
2. 只能在同一分区去重
3. 去重时，若设置版本列则取版本列最大的数据；否则取最后插入的数据
4. 去重时机：同一批插入、合并期间

## SummingMergeTree

将相同主键的行合并为一行，并且将非主键、数值类型的列进行求和（或者指定的列）

该类型可以不设置order by参数

注意：

1. 只能在同一分区去重
2. 去重时机：同一批插入、合并期间

## MergeTree总结

1. 快速插入、管理、检索
2. 底层实现类似LSM树
    1. 新数据会以一个新的树进行存储
    2. 只有合并之后才会把多个树进行融合
    3. 查询时会以最大版本（合并次数）的数据进行查询
    4. 数据合并时机不确定，可以但是不推荐手动触发合并
3. 扩展表引擎以MergeTree为核心，定制合并时的处理机制

## Log引擎

不支持索引，不适合单条的查询，只适合聚合

## More

其他引擎可以浏览一下，但不需要太过深入